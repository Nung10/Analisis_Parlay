<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Kalkulator HDP Advanced + Rekomendasi (Lengkap BTTS + Performa)</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{font-family:Arial,Helvetica,sans-serif;background:#f6f6f6;padding:16px}
.container{max-width:980px;margin:auto;background:#fff;padding:16px;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,.08)}
h2{text-align:center;margin:6px 0 12px}
label{display:block;margin-top:10px;font-weight:600}
.row{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
.row>div{flex:1 1 140px}
input,button,textarea{width:100%;padding:8px;border-radius:6px;border:1px solid #ccc;box-sizing:border-box}
button{margin-top:16px;background:#1976d2;color:#fff;border:none;border-radius:6px;font-size:16px;cursor:pointer}
.result{margin-top:12px;padding:12px;background:#f1f8e9;border-radius:6px;white-space:pre-wrap}
.table{width:100%;border-collapse:collapse;margin-top:10px}
.table td,.table th{border:1px solid #eee;padding:6px;text-align:center}
.reco-box{background:#fff7e6;border-left:4px solid #ffb300;padding:10px;margin-top:10px;border-radius:6px}
.reco-strong{background:#e8f5e9;color:#2e7d32;padding:8px;border-radius:6px;margin-top:8px}
.reco-good{background:#e3f2fd;color:#0d47a1;padding:8px;border-radius:6px;margin-top:8px}
.small{font-size:13px;color:#666;margin-top:6px}
</style>
</head>
<body>
<div class="container">
  <h2>Kalkulator HDP Advanced + Rekomendasi</h2>

  <label>Odds 1X2 (Home / Draw / Away)</label>
  <div class="row">
    <div><input id="oddsHome" type="number" step="0.01" placeholder="Home"></div>
    <div><input id="oddsDraw" type="number" step="0.01" placeholder="Draw"></div>
    <div><input id="oddsAway" type="number" step="0.01" placeholder="Away"></div>
  </div>

  <label>Odds HDP (Home / Away)</label>
  <div class="row">
    <div><input id="hdpHome" type="number" step="0.01" placeholder="HDP Home"></div>
    <div><input id="hdpAway" type="number" step="0.01" placeholder="HDP Away"></div>
  </div>

  <label>Odds Over/Under (Over / Under)</label>
  <div class="row">
    <div><input id="over" type="number" step="0.01" placeholder="Over"></div>
    <div><input id="under" type="number" step="0.01" placeholder="Under"></div>
  </div>

  <label>Odds BTTS (Yes / No)</label>
  <div class="row">
    <div><input id="bttsYes" type="number" step="0.01" placeholder="BTTS Yes"></div>
    <div><input id="bttsNo" type="number" step="0.01" placeholder="BTTS No"></div>
  </div>

  <label>Total Gol & Kebobolan (X laga terakhir)</label>
  <div class="row">
    <div><input id="golHome" type="number" placeholder="Total gol Home"></div>
    <div><input id="kebHome" type="number" placeholder="Total kebobolan Home"></div>
    <div><input id="golAway" type="number" placeholder="Total gol Away"></div>
    <div><input id="kebAway" type="number" placeholder="Total kebobolan Away"></div>
  </div>
  <div class="row">
    <div><input id="matchCount" type="number" value="5" min="1" placeholder="Jumlah laga"></div>
    <div style="flex:2"><input id="bankroll" type="number" value="100" min="1" placeholder="Bankroll (untuk Kelly)"></div>
  </div>

  <label>Performa Tim (W–D–L)</label>
  <div class="row">
    <div><input id="perfHomeW" type="number" placeholder="Home Win"></div>
    <div><input id="perfHomeD" type="number" placeholder="Home Draw"></div>
    <div><input id="perfHomeL" type="number" placeholder="Home Lose"></div>
    <div><input id="perfAwayW" type="number" placeholder="Away Win"></div>
    <div><input id="perfAwayD" type="number" placeholder="Away Draw"></div>
    <div><input id="perfAwayL" type="number" placeholder="Away Lose"></div>
  </div>

  <label>Head-to-Head (H2H)</label>
  <textarea id="h2hText" rows="3" placeholder="Contoh: Home 2-1 Away, Away 1-1 Home"></textarea>

  <button id="btnAnalisis">Analisis & Rekomendasi</button>

  <div id="hasil" class="result">Hasil akan tampil di sini</div>

  <table class="table" id="tbl" style="display:none">
    <thead><tr><th>Metode</th><th>Home</th><th>Draw</th><th>Away</th><th>Over</th><th>Under</th><th>BTTS Yes</th><th>BTTS No</th></tr></thead>
    <tbody id="tbody"></tbody>
  </table>

  <div id="rekomContainer" class="reco-box" style="display:none">
    <strong>Rekomendasi Terbaik</strong>
    <div id="rekom1"></div>
    <div id="rekom2"></div>
    <div id="rekom3"></div>
    <div id="rekom4"></div>
    <div id="rekomAll" style="margin-top:8px;font-size:13px;color:#444"></div>
  </div>

  <canvas id="chart" height="160" style="margin-top:12px"></canvas>
  <div id="performaBox" class="small"></div>
</div>

<script>
// Fungsi helper sederhana
function safeParseFloat(x){let v=parseFloat(x); return isNaN(v)?null:v;}
function factorial(n){return n<=1?1:n*factorial(n-1);}
function poisson(k,lambda){return Math.pow(lambda,k)*Math.exp(-lambda)/factorial(k);}

function computeMatchProbs(lambdaHome,lambdaAway,maxGoals){
  let dist=[]; let pHome=0,pDraw=0,pAway=0,pBoth=0;
  for(let i=0;i<=maxGoals;i++){
    for(let j=0;j<=maxGoals;j++){
      let p=poisson(i,lambdaHome)*poisson(j,lambdaAway);
      if(i>j) pHome+=p; else if(i==j) pDraw+=p; else pAway+=p;
      if(i>0&&j>0) pBoth+=p;
      if(!dist[i+j]) dist[i+j]=0;
      dist[i+j]+=p;
    }
  }
  return {pHome,pDraw,pAway,pBoth,totalDist:dist};
}

function fairifyTwo(o1,o2){
  if(o1==null||o2==null) return [null,null];
  let p1=1/o1, p2=1/o2, sum=p1+p2; return [p1/sum,p2/sum];
}
function fairifyOddsArray(arr){
  let ps=arr.map(o=>o?1/o:0);
  let sum=ps.reduce((a,b)=>a+b,0);
  return ps.map(p=>p/sum);
}

function analyzeAll(){
  const oh=safeParseFloat(document.getElementById('oddsHome').value);
  const od=safeParseFloat(document.getElementById('oddsDraw').value);
  const oa=safeParseFloat(document.getElementById('oddsAway').value);
  const hh=safeParseFloat(document.getElementById('hdpHome').value);
  const ha=safeParseFloat(document.getElementById('hdpAway').value);
  const ov=safeParseFloat(document.getElementById('over').value);
  const un=safeParseFloat(document.getElementById('under').value);
  const by=safeParseFloat(document.getElementById('bttsYes').value);
  const bn=safeParseFloat(document.getElementById('bttsNo').value);

  const golHome=parseFloat(document.getElementById('golHome').value)||0;
  const kebHome=parseFloat(document.getElementById('kebHome').value)||0;
  const golAway=parseFloat(document.getElementById('golAway').value)||0;
  const kebAway=parseFloat(document.getElementById('kebAway').value)||0;
  let matches=parseInt(document.getElementById('matchCount').value)||5;

  const avgGoalsHome=golHome/matches;
  const avgConcedeAway=kebAway/matches;
  const avgGoalsAway=golAway/matches;
  const avgConcedeHome=kebHome/matches;
  let lambdaHome=(avgGoalsHome+avgConcedeAway)/2;
  let lambdaAway=(avgGoalsAway+avgConcedeHome)/2;

  const match=computeMatchProbs(lambdaHome,lambdaAway,10);
  const model={home:match.pHome,draw:match.pDraw,away:match.pAway,
    overProb:ov?match.totalDist.slice(Math.round(ov)+1).reduce((a,b)=>a+b,0):null,
    underProb:un?match.totalDist.slice(0,Math.round(un)+1).reduce((a,b)=>a+b,0):null,
    btts:match.pBoth};

  const fair123=fairifyOddsArray([oh,od,oa]);
  const f_ou=fairifyTwo(ov,un);
  const f_btts=fairifyTwo(by,bn);
  const market={home:fair123[0],draw:fair123[1],away:fair123[2],over:f_ou[0],under:f_ou[1],bttsYes:f_btts[0],bttsNo:f_btts[1]};

  const wm=0.6,wk=0.4;
  function blend(mkt,mdl){return (mkt==null)?mdl:(mdl==null)?mkt: wm*mdl+wk*mkt;}
  const blended={home:blend(market.home,model.home),draw:blend(market.draw,model.draw),away:blend(market.away,model.away),over:blend(market.over,model.overProb),under:blend(market.under,model.underProb),bttsYes:blend(market.bttsYes,model.btts),bttsNo:blend(market.bttsNo,1-model.btts)};

  const body=document.getElementById('tbody'); body.innerHTML='';
  function pct(x){return x==null?'--':(x*100).toFixed(1)+'%';}
  body.innerHTML += `<tr><td>Model</td><td>${pct(model.home)}</td><td>${pct(model.draw)}</td><td>${pct(model.away)}</td><td>${pct(model.overProb)}</td><td>${pct(model.underProb)}</td><td>${pct(model.btts)}</td><td>${pct(1-model.btts)}</td></tr>`;
  body.innerHTML += `<tr><td>Market (fair)</td><td>${pct(market.home)}</td><td>${pct(market.draw)}</td><td>${pct(market.away)}</td><td>${pct(market.over)}</td><td>${pct(market.under)}</td><td>${pct(market.bttsYes)}</td><td>${pct(market.bttsNo)}</td></tr>`;
  body.innerHTML += `<tr><td>Blended</td><td>${pct(blended.home)}</td><td>${pct(blended.draw)}</td><td>${pct(blended.away)}</td><td>${pct(blended.over)}</td><td>${pct(blended.under)}</td><td>${pct(blended.bttsYes)}</td><td>${pct(blended.bttsNo)}</td></tr>`;
  document.getElementById('tbl').style.display='table';
}

document.getElementById('btnAnalisis').addEventListener('click', analyzeAll);
</script>
</body>
</html>