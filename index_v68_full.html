<!doctype html>

<html lang="id">

<head>

<meta charset="utf-8"/>

<meta name="viewport" content="width=device-width,initial-scale=1"/>

<title>Prediksi Odds & Lines — v68 Full (Confidence)</title>

<style>

:root{

  --bg:#041018; --panel:#071826; --card:#0b1a22; --muted:#9fb3c5; --accent:#0b74de;

  --good:#2ecc71; --warn:#f1c40f; --bad:#e74c3c; --text:#dff3ff;

}

*{box-sizing:border-box}

body{margin:0;font-family:Inter,Segoe UI,Arial,sans-serif;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased}

.container{max-width:980px;margin:18px auto;padding:18px}

h1{margin:0 0 8px;font-size:22px;color:#cfe9ff}

.panel{background:var(--panel);border-radius:10px;padding:12px;margin-bottom:12px;border:1px solid rgba(255,255,255,0.03)}

label{display:block;font-size:13px;color:var(--muted);margin-top:8px}

input[type="text"], input[type="number"], input[type="date"], select, textarea {width:100%;padding:8px;border-radius:8px;border:1px solid #22333f;background:#08131a;color:#fff;font-size:14px}

.row{display:flex;gap:10px;flex-wrap:wrap}

.col{flex:1 1 260px;min-width:220px}

button{padding:8px 12px;border-radius:8px;border:0;background:var(--accent);color:#fff;cursor:pointer}

button.ghost{background:transparent;border:1px solid #233645;color:#cfe9ff;padding:6px 8px;border-radius:6px;cursor:pointer}

.small{font-size:12px;color:var(--muted)}

.result{background:#06121a;padding:12px;border-radius:8px;border:1px dashed rgba(255,255,255,0.03);font-family:monospace;white-space:pre-wrap}

.card{display:flex;justify-content:space-between;padding:10px;border-radius:8px;background:#061922;margin-bottom:8px}

canvas{background:transparent;border-radius:6px}

.status-green{color:var(--good)} .status-yellow{color:var(--warn)} .status-red{color:var(--bad)}

.flex-between{display:flex;justify-content:space-between;align-items:center}

.muted{color:var(--muted);font-size:13px}

.label-pill{padding:4px 8px;border-radius:999px;background:#062634;color:#cfe9ff;font-size:12px}

.progress-wrap{background:#07202a;border-radius:10px;padding:6px;margin-top:8px}

.progress-fill{height:16px;border-radius:8px;width:0%;transition:width .6s ease}

.table{width:100%;border-collapse:collapse;margin-top:8px}

.table th,.table td{padding:6px;border-bottom:1px solid #0f2a33;text-align:left;font-size:13px}

@media (max-width:720px){.col{flex-basis:100%}}

</style>

</head>

<body>

<div class="container">

  <h1>Prediksi Odds & Lines — v68 Full</h1>

  <p class="small">Minimal: Rating Sofascore & Performa (H2H). Mode: League/Cup/Custom. Confidence meter & CSV.</p>



  <!-- Match Info -->

  <div class="panel">

    <div class="row">

      <div class="col"><label>League / Cup</label>

        <select id="competition"><option>League</option><option>Cup</option><option>Friendly</option></select></div>

      <div class="col"><label>Tanggal</label><input id="matchDate" type="date"></div>

    </div>

    <label>Nama Pertandingan (Home vs Away)</label>

    <input id="matchName" type="text" placeholder="Contoh: Atalanta vs Lazio">

  </div>



  <!-- Teams & Stats -->

  <div class="panel">

    <h3 style="margin:0">Data Tim (Satu nilai per tim + H2H simple)</h3>

    <div class="row">

      <div class="col">

        <label>Home Team</label><input id="teamHome" type="text" placeholder="Home FC">

        <label>Average Sofascore Rating (Home)</label><input id="ratingHome" type="number" step="0.01" placeholder="6.85">

        <label>Performa Terbaru / H2H (Home) (0-1)</label><input id="formHome" type="number" step="0.01" placeholder="0.72">

        <label>H2H recent (Home vs Away) (ex: W,D,L,W,L) — kosong jika tidak ada</label><input id="h2hInput" type="text" placeholder="W,D,L,W,D">

      </div>



      <div class="col">

        <label>Away Team</label><input id="teamAway" type="text" placeholder="Away FC">

        <label>Average Sofascore Rating (Away)</label><input id="ratingAway" type="number" step="0.01" placeholder="6.70">

        <label>Performa Terbaru / H2H (Away) (0-1)</label><input id="formAway" type="number" step="0.01" placeholder="0.58">

        <label>H2H home-win rate (optional, 0-1) — akan dihitung dari H2H field jika kosong</label><input id="h2hRate" type="number" step="0.01" placeholder="">

      </div>

    </div>



    <h4 style="margin-top:10px">Optional: tambahan statistik (bisa dikosongkan)</h4>

    <div class="row">

      <div class="col"><label>xG per game (Home)</label><input id="xgHome" type="number" step="0.01" placeholder="1.25"></div>

      <div class="col"><label>xG per game (Away)</label><input id="xgAway" type="number" step="0.01" placeholder="1.05"></div>

    </div>

    <div class="row" style="margin-top:8px">

      <div class="col"><label>Shots on Target per game (Home)</label><input id="sotHome" type="number" step="0.01" placeholder="4.2"></div>

      <div class="col"><label>Shots on Target per game (Away)</label><input id="sotAway" type="number" step="0.01" placeholder="3.4"></div>

    </div>



    <h4 style="margin-top:10px">Clean Sheet Ratio & GA (bisa hitung otomatis)</h4>

    <div class="row">

      <div class="col">

        <label>Clean Sheets (Home) — jumlah</label><input id="csCountHome" type="number" step="1" placeholder="3">

        <label>Matches considered (Home)</label><input id="csMatchesHome" type="number" step="1" placeholder="10">

        <label>Clean Sheet Ratio (Home) (0-1)</label><input id="csHome" type="number" step="0.01" placeholder="0.30" readonly>

        <button id="btnCalcCSHome" class="ghost" style="margin-top:8px">Hitung CSR Home</button>

      </div>

      <div class="col">

        <label>Clean Sheets (Away)</label><input id="csCountAway" type="number" step="1" placeholder="2">

        <label>Matches considered (Away)</label><input id="csMatchesAway" type="number" step="1" placeholder="10">

        <label>Clean Sheet Ratio (Away) (0-1)</label><input id="csAway" type="number" step="0.01" placeholder="0.20" readonly>

        <button id="btnCalcCSAway" class="ghost" style="margin-top:8px">Hitung CSR Away</button>

      </div>

    </div>



    <div style="margin-top:10px" class="row">

      <div class="col">

        <label>Total Goals Conceded (Home)</label><input id="gcHomeCount" type="number" step="1" placeholder="12">

        <label>Matches considered (Home) untuk GA</label><input id="gcMatchesHome" type="number" step="1" placeholder="10">

        <label>Goals Conceded per Game (Home)</label><input id="gcHome" type="number" step="0.01" placeholder="1.2" readonly>

        <button id="btnCalcGAHome" class="ghost" style="margin-top:8px">Hitung GA Home</button>

      </div>

      <div class="col">

        <label>Total Goals Conceded (Away)</label><input id="gcAwayCount" type="number" step="1" placeholder="14">

        <label>Matches considered (Away) untuk GA</label><input id="gcMatchesAway" type="number" step="1" placeholder="10">

        <label>Goals Conceded per Game (Away)</label><input id="gcAway" type="number" step="0.01" placeholder="1.4" readonly>

        <button id="btnCalcGAAway" class="ghost" style="margin-top:8px">Hitung GA Away</button>

      </div>

    </div>



  </div>



  <!-- Odds -->

  <div class="panel">

    <h3 style="margin:0">Odds & Lines</h3>

    <div class="row">

      <div class="col"><label>HDP Line (contoh 0.25)</label><input id="hdpLine" type="number" step="0.25" value="0.25"></div>

      <div class="col"><label>OU Line (contoh 2.5)</label><input id="ouLine" type="number" step="0.25" value="2.5"></div>

    </div>

    <div class="row" style="margin-top:8px">

      <div class="col"><label>HDP Home (Open)</label><input id="hdpHomeOpen" type="number" step="0.01"></div>

      <div class="col"><label>HDP Home (Now)</label><input id="hdpHomeNow" type="number" step="0.01"></div>

      <div class="col"><label>HDP Away (Open)</label><input id="hdpAwayOpen" type="number" step="0.01"></div>

    </div>

    <div class="row" style="margin-top:8px">

      <div class="col"><label>HDP Away (Now)</label><input id="hdpAwayNow" type="number" step="0.01"></div>

      <div class="col"><label>OU Over (Open)</label><input id="ouOverOpen" type="number" step="0.01"></div>

      <div class="col"><label>OU Over (Now)</label><input id="ouOverNow" type="number" step="0.01"></div>

    </div>

    <div class="row" style="margin-top:8px">

      <div class="col"><label>OU Under (Open)</label><input id="ouUnderOpen" type="number" step="0.01"></div>

      <div class="col"><label>OU Under (Now)</label><input id="ouUnderNow" type="number" step="0.01"></div>

      <div class="col"><label>MC Runs (default)</label><input id="mcRuns" type="number" step="1000" value="40000"></div>

    </div>

    <div class="row" style="margin-top:8px">

      <div class="col"><label>ρ (rho)</label><input id="rho" type="number" step="0.01" value="0.12"></div>

      <div class="col"><label>Alpha shrink (0-0.5)</label><input id="alpha" type="number" step="0.01" value="0.15"></div>

      <div class="col"><label>Mode</label>

        <select id="modeSelect"><option value="league">League</option><option value="cup">Cup</option><option value="custom">Custom</option></select>

      </div>

    </div>

    <div style="margin-top:10px">

      <button id="btnAnalyze">Analisis</button>

      <button id="btnExample" class="ghost">Contoh</button>

      <button id="btnReset" class="ghost">Reset</button>

      <button id="btnDownload" class="ghost">Download CSV</button>

    </div>

  </div>



  <!-- Results -->

  <div class="panel">

    <h3 style="margin:0">Hasil & Rekomendasi</h3>

    <div id="summary" class="result" style="margin-top:8px">Klik Analisis untuk hasil.</div>



    <div id="recs" style="margin-top:8px"></div>



    <!-- Confidence meter -->

    <div style="margin-top:12px">

      <label class="small">Confidence Meter (highest model probability)</label>

      <div class="progress-wrap">

        <div id="confFill" class="progress-fill" style="background:#00ff9d;width:0%"></div>

      </div>

      <div id="confText" class="small" style="text-align:right;margin-top:6px">Confidence: 0%</div>

    </div>



    <div style="display:flex;gap:12px;margin-top:12px;align-items:center;flex-wrap:wrap">

      <canvas id="hist" width="520" height="140"></canvas>

    </div>



    <div id="debug" class="result" style="margin-top:8px;background:#07121b"></div>

  </div>



  <p class="small muted">Catatan: jika ingin akurasi lebih tinggi, isi juga xG/SOT dan CSR/GA.</p>

</div>



<script>
/* ===== Utilities ===== */
function safe(v,d=NaN){ const x=parseFloat(v); return (isNaN(x)?d:x); }
function pct(x){ if(isNaN(x)) return '-'; return (100*x).toFixed(1)+'%'; }
function clamp(v,a,b){ if(v<a) return a; if(v>b) return b; return v; }
function poisson(lambda){ let L=Math.exp(-lambda), p=1, k=0; while(p>L){ k++; p*=Math.random(); if(k>10000) break; } return k-1; }

/* ===== Hitung CSR & GA ===== */
function calcRatio(count,matches,target){
  if(matches<=0){ alert('Isi jumlah pertandingan dulu'); return; }
  const ratio = clamp(count/matches,0,1);
  target.value = ratio.toFixed(2);
}
document.getElementById('btnCalcCSHome').onclick=()=>calcRatio(safe(csCountHome.value,0),safe(csMatchesHome.value,0),csHome);
document.getElementById('btnCalcCSAway').onclick=()=>calcRatio(safe(csCountAway.value,0),safe(csMatchesAway.value,0),csAway);
document.getElementById('btnCalcGAHome').onclick=()=>calcRatio(safe(gcHomeCount.value,0),safe(gcMatchesHome.value,0),gcHome);
document.getElementById('btnCalcGAAway').onclick=()=>calcRatio(safe(gcAwayCount.value,0),safe(gcMatchesAway.value,0),gcAway);

/* ===== Mode presets ===== */
modeSelect.addEventListener('change', ()=>{
  const m = modeSelect.value;
  if(m==='league'){ alpha.value='0.10'; rho.value='0.12'; mcRuns.value='40000'; }
  else if(m==='cup'){ alpha.value='0.16'; rho.value='0.18'; mcRuns.value='80000'; }
});

/* ===== Reset dan Example ===== */
btnReset.onclick=()=>{
  const keep=['alpha','rho','mcRuns','modeSelect'];
  document.querySelectorAll('input,select').forEach(e=>{
    if(!keep.includes(e.id)) e.value='';
  });
  summary.textContent='Klik Analisis untuk hasil.';
  recs.innerHTML=''; confFill.style.width='0%'; hist.getContext('2d').clearRect(0,0,520,140);
};

btnExample.onclick=()=>{
  matchName.value='Atalanta vs Lazio';
  ratingHome.value=6.75; ratingAway.value=6.45;
  formHome.value=0.66; formAway.value=0.53;
  xgHome.value=1.35; xgAway.value=1.05;
  sotHome.value=5.5; sotAway.value=3.8;
  csCountHome.value=5; csMatchesHome.value=12; btnCalcCSHome.click();
  csCountAway.value=3; csMatchesAway.value=12; btnCalcCSAway.click();
  gcHomeCount.value=10; gcMatchesHome.value=12; btnCalcGAHome.click();
  gcAwayCount.value=13; gcMatchesAway.value=12; btnCalcGAAway.click();
  hdpLine.value=0.25; ouLine.value=2.5;
  hdpHomeNow.value=1.88; hdpAwayNow.value=2.04;
  ouOverNow.value=1.90; ouUnderNow.value=1.92;
};

/* ===== Model functions ===== */
function computeAttackIndex(xg,sot,form,rating){
  const rF = (rating>0)?rating/6.4:1;
  const base = 0.46*(xg||1)+0.24*((sot||3)/5)+0.12*(form||0.5);
  return Math.max(0.08, base*rF);
}
function computeDefenseIndex(cs,ga){
  const csAdj = 1 - clamp(cs*0.4,0,0.6);
  const gaAdj = 1 + 0.22*(ga||1.2);
  return clamp(csAdj*gaAdj,0.45,2.8);
}
function samplePair(lH,lA,rho){
  const shared=Math.max(0,rho*Math.min(lH,lA));
  return [poisson(lH-shared+shared),poisson(lA-shared+shared)];
}

/* ===== Analisis utama ===== */
btnAnalyze.onclick=()=>{
  const teamH=teamHome.value||'Home', teamA=teamAway.value||'Away';
  const ratingH=safe(ratingHome.value,6.4), ratingA=safe(ratingAway.value,6.2);
  const formH=clamp(safe(formHome.value,0.5),0,1), formA=clamp(safe(formAway.value,0.5),0,1);
  const xgH=safe(xgHome.value,ratingH/5), xgA=safe(xgAway.value,ratingA/5);
  const sotH=safe(sotHome.value,4), sotA=safe(sotAway.value,3);
  const csH=safe(csHome.value,0.25), csA=safe(csAway.value,0.25);
  const gaH=safe(gcHome.value,1.2), gaA=safe(gcAway.value,1.3);

  const atkH=computeAttackIndex(xgH,sotH,formH,ratingH);
  const atkA=computeAttackIndex(xgA,sotA,formA,ratingA);
  const defH=computeDefenseIndex(csH,gaH);
  const defA=computeDefenseIndex(csA,gaA);

  const alphaVal=clamp(safe(alpha.value,0.10),0,0.4);
  const rhoVal=clamp(safe(rho.value,0.12),-0.5,0.8);
  const runs=Math.max(1000,parseInt(mcRuns.value||40000));

  let lH=(atkH/defA), lA=(atkA/defH);
  lH = alphaVal*(ratingH/5)+(1-alphaVal)*lH;
  lA = alphaVal*(ratingA/5)+(1-alphaVal)*lA;
  lH=clamp(lH,0.1,3.0); lA=clamp(lA,0.1,3.0);

  let winH=0,draw=0,winA=0,tot={},freq={};
  for(let i=0;i<runs;i++){
    const [gh,ga]=samplePair(lH,lA,rhoVal);
    const k=gh+'-'+ga; freq[k]=(freq[k]||0)+1; tot[gh+ga]=(tot[gh+ga]||0)+1;
    if(gh>ga)winH++; else if(gh==ga)draw++; else winA++;
  }

  const pH=winH/runs, pD=draw/runs, pA=winA/runs;
  const ou=parseFloat(ouLine.value)||2.5;
  let over=0,under=0;
  for(const k in tot){ const g=parseInt(k); if(g>ou)over+=tot[k]; else under+=tot[k]; }
  const pOver=over/runs, pUnder=under/runs;

  const coverH=Object.entries(freq).reduce((s,[sc,c])=>{const [gh,ga]=sc.split('-').map(Number);return s+(gh-ga>parseFloat(hdpLine.value)?c:0);},0)/runs;
  const coverA=1-coverH;

  /* --- Odds pasar --- */
  const oddH=safe(hdpHomeNow.value,NaN), oddA=safe(hdpAwayNow.value,NaN);
  const oddOver=safe(ouOverNow.value,NaN), oddUnder=safe(ouUnderNow.value,NaN);
  const impH=oddH?1/oddH:NaN, impA=oddA?1/oddA:NaN, impO=oddOver?1/oddOver:NaN, impU=oddUnder?1/oddUnder:NaN;

  /* --- Bandingkan pasar vs model --- */
  function compare(marketProb, impProb){
    if(isNaN(marketProb)||isNaN(impProb)) return '-';
    const diff=(marketProb-impProb)*100;
    if(Math.abs(diff)<5) return 'Sejalan dengan pasar';
    return diff>0?'Pasar sedikit tertinggal (model unggul)':'Pasar berlebihan (trap kemungkinan)';
  }

  const noteH=compare(coverH,impH);
  const noteO=compare(pOver,impO);

  /* --- Confidence meter --- */
  const topProb=Math.max(pH,pA,pOver,pUnder);
  const conf=Math.round(topProb*100);
  confFill.style.width=conf+'%';
  confFill.style.background=conf<45?'#ff4d4d':conf<65?'#ffb84d':'#00ff9d';
  confText.textContent='Confidence: '+conf+'%';

  /* --- Output --- */
  summary.textContent=
`λ Home=${lH.toFixed(2)} λ Away=${lA.toFixed(2)}
Prob 1X2 → Home ${pct(pH)} Draw ${pct(pD)} Away ${pct(pA)}
OU(${ou}) → Over ${pct(pOver)} Under ${pct(pUnder)}
HDP(${hdpLine.value}) → Home ${pct(coverH)} Away ${pct(coverA)}
Confidence: ${conf}%
Analisis Pasar:
- HDP: ${noteH}
- OU: ${noteO}`;

  /* --- Chart --- */
  const ctx=hist.getContext('2d'); ctx.clearRect(0,0,520,140);
  const keys=Object.keys(tot).map(k=>+k).sort((a,b)=>a-b);
  const max=Math.max(...Object.values(tot));
  keys.forEach((k,i)=>{
    const x=20+i*40, h=(tot[k]/max)*100;
    ctx.fillStyle='#0b74de'; ctx.fillRect(x,120-h,30,h);
    ctx.fillStyle='#9fb3c5'; ctx.fillText(k,x,135);
  });
};
</script>
</body>

</html>

