<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kalkulator HDP Full</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{font-family:Arial,sans-serif;background:#f6f6f6;padding:20px;}
.container{max-width:800px;margin:auto;background:#fff;padding:20px;border-radius:10px;
           box-shadow:0 2px 6px rgba(0,0,0,0.12);}
h2{text-align:center}
label{display:block;margin-top:12px;font-weight:bold}
textarea,select{width:100%;padding:8px;margin-top:5px;border:1px solid #ccc;border-radius:6px}
button{margin-top:15px;padding:10px;width:100%;background:#4CAF50;color:#fff;
       border:none;border-radius:6px;font-size:16px;cursor:pointer}
button:hover{background:#45a049}
.result{margin-top:15px;padding:12px;background:#eef;border-radius:6px;white-space:pre-wrap}
.chart-container{margin-top:20px}
canvas{max-width:100%;}
.small{font-size:13px;color:#666}
</style>
</head>
<body>
<div class="container">
<h2>Kalkulator HDP, Over/Under & Probabilitas</h2>

<!-- Input Odds -->
<label>Odds 1X2</label>
<select id="oddsHome1x2"></select>
<select id="oddsDraw1x2"></select>
<select id="oddsAway1x2"></select>

<label>Odds HDP</label>
<select id="hdpHome"></select>
<select id="hdpAway"></select>

<label>Over/Under</label>
<select id="over"></select>
<select id="under"></select>

<!-- BTTS Data -->
<label>Total Gol & Kebobolan (Home)</label>
<select id="golHome"></select>
<select id="kebobolanHome"></select>

<label>Total Gol & Kebobolan (Away)</label>
<select id="golAway"></select>
<select id="kebobolanAway"></select>

<!-- Performa -->
<label>Performa Tim (W/D/L)</label>
<textarea id="formHome" placeholder="Home: W W D L W"></textarea>
<textarea id="formAway" placeholder="Away: L D W W L"></textarea>

<label>Jumlah laga terakhir dianalisis</label>
<select id="matchCount">
  <option value="5">5 laga</option>
  <option value="10">10 laga</option>
  <option value="all">Semua</option>
</select>

<button onclick="analisis()">Analisis</button>

<div class="result" id="ringkasan">Ringkasan Prediksi: --</div>

<div class="result" id="hasil" style="display:none">
  <p><b>Probabilitas 1X2:</b> Home <span id="homeProb">--</span> | Draw <span id="drawProb">--</span> | Away <span id="awayProb">--</span></p>
  <p><b>Probabilitas HDP:</b> Home <span id="hdpHomeProb">--</span> | Away <span id="hdpAwayProb">--</span></p>
  <p><b>Probabilitas Over/Under:</b> Over <span id="overProb">--</span> | Under <span id="underProb">--</span></p>
  <p><b>Probabilitas BTTS:</b> Yes <span id="bttsYesProb">--</span> | No <span id="bttsNoProb">--</span></p>
</div>

<div class="chart-container"><canvas id="chart1x2"></canvas></div>
<div class="chart-container"><canvas id="chartHDP"></canvas></div>
<div class="chart-container"><canvas id="chartOU"></canvas></div>
<div class="chart-container"><canvas id="chartBTTS"></canvas></div>
<div class="chart-container"><canvas id="chartForm"></canvas></div>

</div>

<script>
let chart1x2, chartHDP, chartOU, chartBTTS, chartForm;

function isiDropdown(id,start,end,step){
  const sel=document.getElementById(id);
  sel.innerHTML="";
  const def=document.createElement("option");
  def.value="";def.text="-- Pilih --";sel.appendChild(def);
  for(let v=start; v<=end+1e-9; v+=step){
    const o=document.createElement("option");
    o.value=v.toFixed(2);
    o.text=v.toFixed(2);
    sel.appendChild(o);
  }
}
function isiDropdownInt(id,start,end){
  const sel=document.getElementById(id);
  sel.innerHTML="";
  const def=document.createElement("option");
  def.value="";def.text="-- Pilih --";sel.appendChild(def);
  for(let v=start; v<=end; v++){
    const o=document.createElement("option");
    o.value=v;
    o.text=v;
    sel.appendChild(o);
  }
}

function buatChart(chartRef,canvasId,labels,data,type='pie'){
  if(chartRef) chartRef.destroy();
  return new Chart(document.getElementById(canvasId),{
    type:type,
    data:{labels:labels,datasets:[{data:data,backgroundColor:['#4CAF50','#FFC107','#2196F3','#9C27B0']}]},
    options:{plugins:{legend:{position:'bottom'}}}
  });
}

function parseForm(formText,count){
  if(!formText) return [];
  let arr=formText.trim().split(/\s+/);
  if(count!=="all") arr=arr.slice(0,parseInt(count));
  return arr.map(v=>{
    v=v.toUpperCase();
    if(v==="W") return 3;
    if(v==="D") return 1;
    return 0;
  });
}

function analisis(){
  document.getElementById('hasil').style.display="block";

  const oh=parseFloat(document.getElementById('oddsHome1x2').value);
  const od=parseFloat(document.getElementById('oddsDraw1x2').value);
  const oa=parseFloat(document.getElementById('oddsAway1x2').value);
  const hh=parseFloat(document.getElementById('hdpHome').value);
  const ha=parseFloat(document.getElementById('hdpAway').value);
  const ov=parseFloat(document.getElementById('over').value);
  const un=parseFloat(document.getElementById('under').value);
  const gH=parseFloat(document.getElementById('golHome').value);
  const kH=parseFloat(document.getElementById('kebobolanHome').value);
  const gA=parseFloat(document.getElementById('golAway').value);
  const kA=parseFloat(document.getElementById('kebobolanAway').value);
  const matchCount=document.getElementById('matchCount').value;

  let summary=[];

  // 1X2
  if(!isNaN(oh)&&!isNaN(od)&&!isNaN(oa)){
    const s=1/oh+1/od+1/oa;
    const pH=(1/oh)/s*100,pD=(1/od)/s*100,pA=(1/oa)/s*100;
    homeProb.textContent=pH.toFixed(1)+"%";
    drawProb.textContent=pD.toFixed(1)+"%";
    awayProb.textContent=pA.toFixed(1)+"%";
    chart1x2=buatChart(chart1x2,'chart1x2',['Home','Draw','Away'],[pH,pD,pA]);
    if(pH>50) summary.push("Home Win"); else if(pA>50) summary.push("Away Win");
  }

  // HDP
  if(!isNaN(hh)&&!isNaN(ha)){
    const s=1/hh+1/ha;
    const pHH=(1/hh)/s*100,pAA=(1/ha)/s*100;
    hdpHomeProb.textContent=pHH.toFixed(1)+"%";
    hdpAwayProb.textContent=pAA.toFixed(1)+"%";
    chartHDP=buatChart(chartHDP,'chartHDP',['HDP Home','HDP Away'],[pHH,pAA]);
    if(pHH>55) summary.push("HDP Home"); else if(pAA>55) summary.push("HDP Away");
  }

  // Over/Under
  if(!isNaN(ov)&&!isNaN(un)){
    const s=1/ov+1/un;
    const pO=(1/ov)/s*100,pU=(1/un)/s*100;
    overProb.textContent=pO.toFixed(1)+"%";
    underProb.textContent=pU.toFixed(1)+"%";
    chartOU=buatChart(chartOU,'chartOU',['Over','Under'],[pO,pU]);
    if(pO>60) summary.push("Over"); else if(pU>60) summary.push("Under");
  }

  // BTTS
  if(!isNaN(gH)&&!isNaN(kH)&&!isNaN(gA)&&!isNaN(kA)){
    const total=(matchCount==="all")?5:parseInt(matchCount);
    const avgHome=gH/total,avgCH=kH/total,avgAway=gA/total,avgCA=kA/total;
    let score=(avgHome*avgCA + avgAway*avgCH);
    let pYes=score/(score+1),pNo=1-pYes;
    bttsYesProb.textContent=(pYes*100).toFixed(1)+"%";
    bttsNoProb.textContent=(pNo*100).toFixed(1)+"%";
    chartBTTS=buatChart(chartBTTS,'chartBTTS',['BTTS Yes','BTTS No'],[pYes*100,pNo*100]);
    if(pYes>0.6) summary.push("BTTS Yes"); else if(pYes<0.4) summary.push("BTTS No");
  }

  // Tren Performa
  const fH=formHome.value.trim();
  const fA=formAway.value.trim();
  const tH=parseForm(fH,matchCount);
  const tA=parseForm(fA,matchCount);
  if(tH.length||tA.length){
    const labels=Array.from({length:Math.max(tH.length,tA.length)},(_,i)=>"Laga "+(i+1));
    chartForm=buatChart(chartForm,'chartForm',labels,[], 'line');
    chartForm.data.datasets=[
      {label:'Home',data:tH,borderColor:'#4CAF50',fill:false},
      {label:'Away',data:tA,borderColor:'#F44336',fill:false}
    ];
    chartForm.update();
  }

  ringkasan.textContent="Ringkasan Prediksi: "+(summary.length?summary.join(" & "):"--");
}

// isi dropdown saat DOM siap
document.addEventListener("DOMContentLoaded",()=>{
  isiDropdown("oddsHome1x2",1.00,20.00,0.25);
  isiDropdown("oddsDraw1x2",1.00,20.00,0.25);
  isiDropdown("oddsAway1x2",1.00,20.00,0.25);
  isiDropdown("hdpHome",1.00,20.00,0.25);
  isiDropdown("hdpAway",1.00,20.00,0.25);
  isiDropdown("over",1.00,2.50,0.05);
  isiDropdown("under",1.00,2.50,0.05);
  isiDropdownInt("golHome",1,50);
  isiDropdownInt("kebobolanHome",1,50);
  isiDropdownInt("golAway",1,50);
  isiDropdownInt("kebobolanAway",1,50);
});
</script>
</body>
</html>
