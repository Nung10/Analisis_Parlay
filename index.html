<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Kalkulator HDP Full (1X2 + O/U + HDP + Market + Blended)</title>
<style>
  body{font-family:Arial,Helvetica,sans-serif;background:#f3f6f8;padding:16px}
  .container{max-width:980px;margin:18px auto;background:#fff;padding:18px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,.06)}
  h2{text-align:center;margin:6px 0 14px}
  label{display:block;margin-top:10px;font-weight:700}
  .row{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
  .row>div{flex:1 1 150px}
  input,select,textarea,button{width:100%;padding:8px;border-radius:6px;border:1px solid #d0d7de;box-sizing:border-box}
  button{background:#1565c0;color:#fff;border:none;cursor:pointer;font-weight:700}
  .result{margin-top:12px;padding:12px;background:#f1f8e9;border-radius:6px;white-space:pre-wrap}
  table.table{width:100%;border-collapse:collapse;margin-top:12px}
  table.table th, table.table td{border:1px solid #e7eef6;padding:8px;text-align:center}
  .reco{margin-top:12px;padding:10px;border-radius:8px;background:#fff8e1;border-left:6px solid #ffb300}
  .good{background:#e8f5e9;padding:8px;border-radius:6px;margin-top:8px}
  .badge{display:inline-block;padding:4px 8px;border-radius:999px;background:#e3f2fd;color:#0d47a1;font-weight:700;margin-left:6px}
  .small{font-size:13px;color:#556}
  .muted{color:#666;font-size:13px;margin-top:8px}
</style>
</head>
<body>
<div class="container">
  <h2>Kalkulator HDP Advanced + Market & Blended (Full)</h2>

  <label>Odds 1X2 (Home / Draw / Away)</label>
  <div class="row">
    <div><input id="oddsHome" type="number" step="0.01" placeholder="Home e.g. 1.90"></div>
    <div><input id="oddsDraw" type="number" step="0.01" placeholder="Draw e.g. 3.40"></div>
    <div><input id="oddsAway" type="number" step="0.01" placeholder="Away e.g. 4.00"></div>
  </div>

  <label>Odds HDP (Line / Odds Home / Odds Away)</label>
  <div class="row">
    <div><input id="hdpLine" type="number" step="0.25" placeholder="HDP line (eg -0.5, +0.5)"></div>
    <div><input id="hdpHomeOdd" type="number" step="0.01" placeholder="Odds HDP Home"></div>
    <div><input id="hdpAwayOdd" type="number" step="0.01" placeholder="Odds HDP Away"></div>
  </div>

  <label>Over/Under ‚Äî Line & Odds</label>
  <div class="row">
    <div><input id="ouLine" type="number" step="0.1" placeholder="Line O/U e.g. 2.5"></div>
    <div><input id="overOdd" type="number" step="0.01" placeholder="Odds Over"></div>
    <div><input id="underOdd" type="number" step="0.01" placeholder="Odds Under"></div>
  </div>

  <label>Total Gol & Kebobolan (X laga terakhir per tim)</label>
  <div class="row">
    <div><input id="golHome" type="number" placeholder="Total gol Home"></div>
    <div><input id="kebHome" type="number" placeholder="Total kebobolan Home"></div>
    <div><input id="golAway" type="number" placeholder="Total gol Away"></div>
    <div><input id="kebAway" type="number" placeholder="Total kebobolan Away"></div>
  </div>

  <div class="row">
    <div><input id="matchCount" type="number" value="5" min="1" placeholder="Jumlah laga (mis. 5)"></div>
    <div><input id="bankroll" type="number" value="100" min="1" placeholder="Bankroll (untuk Kelly)"></div>
    <div>
      <select id="modelType">
        <option value="poisson">Poisson</option>
        <option value="negbin">Negative Binomial (simple)</option>
      </select>
    </div>
  </div>

  <label>Performa Tim Home (W-D-L) & Away (W-D-L)</label>
  <div class="row">
    <div><input id="hW" type="number" placeholder="Home W"></div>
    <div><input id="hD" type="number" placeholder="Home D"></div>
    <div><input id="hL" type="number" placeholder="Home L"></div>
    <div><input id="aW" type="number" placeholder="Away W"></div>
    <div><input id="aD" type="number" placeholder="Away D"></div>
    <div><input id="aL" type="number" placeholder="Away L"></div>
  </div>

  <div style="margin-top:12px">
    <button id="btn">Analisis & Rekomendasi</button>
  </div>

  <div id="output" class="result">Hasil akan tampil di sini</div>

  <table class="table" id="tbl" style="display:none">
    <thead>
      <tr><th>Metode</th><th>Home</th><th>Draw</th><th>Away</th><th>Over</th><th>Under</th><th>HDP Home</th><th>HDP Away</th></tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>

  <div id="recom" class="reco" style="display:none"></div>

  <div class="muted">‚ö†Ô∏è Pastikan file ini bernama <b>index.html</b> di repo GitHub Pages Anda (nung10.github.io).</div>
</div>

<script>
// === Utility ===
function safe(v,d=null){const x=parseFloat(v);return isNaN(x)?d:x;}
function factorial(n){return n<=1?1:n*factorial(n-1);}
function poisson(k,lambda){return Math.exp(-lambda)*Math.pow(lambda,k)/factorial(k);}
function negbinPmf(k,mean,r=1.5){const p=r/(r+mean);function comb(n,k){let res=1;for(let i=1;i<=k;i++){res=res*(n-k+i)/i;}return res;}return comb(k+r-1,k)*Math.pow(1-p,k)*Math.pow(p,r);}

function computeMatrix(lambdaH,lambdaA,maxGoals,modelType){
  const matrix={}, totalDist=[];let pHome=0,pDraw=0,pAway=0;
  for(let i=0;i<=maxGoals;i++){
    for(let j=0;j<=maxGoals;j++){
      const p=(modelType==='poisson')?poisson(i,lambdaH)*poisson(j,lambdaA):negbinPmf(i,lambdaH)*negbinPmf(j,lambdaA);
      matrix[`${i}-${j}`]=p;totalDist[i+j]=(totalDist[i+j]||0)+p;
      if(i>j)pHome+=p;else if(i===j)pDraw+=p;else pAway+=p;
    }
  }
  return{matrix,totalDist,pHome,pDraw,pAway};
}
function computeOUFromDist(totalDist,line){
  let over=0,under=0;const isInt=Number.isInteger(line);
  for(let g=0;g<totalDist.length;g++){const p=totalDist[g]||0;
    if(isInt){if(g>line)over+=p;else if(g<line)under+=p;else{over+=0.5*p;under+=0.5*p;}}
    else{if(g>line)over+=p;else under+=p;}
  }
  return{over,under};
}
function computeHDPFromMatrix(matrix,line){
  let ph=0,pa=0,push=0;
  for(const key in matrix){const p=matrix[key];const[i,j]=key.split('-').map(Number);const diff=i-j+line;
    if(diff>0)ph+=p;else if(diff<0)pa+=p;else push+=p;
  }
  return{ph,pa,push};
}
function fairifyOdds(arr){const inv=arr.map(o=>o?1/Number(o):0);const sum=inv.reduce((s,a)=>s+a,0);if(sum===0)return arr.map(()=>null);return inv.map(x=>x/sum);}
function kellyFraction(p,marketProb,decimalOdd){const b=decimalOdd-1;if(!decimalOdd||b<=0)return 0;const q=1-p;const f=(b*p-q)/b;return Math.max(0,f);}

// === Main ===
document.getElementById('btn').addEventListener('click',analyzeAll);
function analyzeAll(){
  const oddsHome=safe(document.getElementById('oddsHome').value,null);
  const oddsDraw=safe(document.getElementById('oddsDraw').value,null);
  const oddsAway=safe(document.getElementById('oddsAway').value,null);
  const hdpLine=safe(document.getElementById('hdpLine').value,0);
  const hdpHomeOdd=safe(document.getElementById('hdpHomeOdd').value,null);
  const hdpAwayOdd=safe(document.getElementById('hdpAwayOdd').value,null);
  const ouLine=safe(document.getElementById('ouLine').value,2.5);
  const overOdd=safe(document.getElementById('overOdd').value,null);
  const underOdd=safe(document.getElementById('underOdd').value,null);
  const golHome=safe(document.getElementById('golHome').value,0),kebHome=safe(document.getElementById('kebHome').value,0);
  const golAway=safe(document.getElementById('golAway').value,0),kebAway=safe(document.getElementById('kebAway').value,0);
  const matchCount=Math.max(1,parseInt(document.getElementById('matchCount').value||5));
  const bankroll=safe(document.getElementById('bankroll').value,100);
  const modelType=document.getElementById('modelType').value;
  const hW=safe(document.getElementById('hW').value,0),hD=safe(document.getElementById('hD').value,0),hL=safe(document.getElementById('hL').value,0);
  const aW=safe(document.getElementById('aW').value,0),aD=safe(document.getElementById('aD').value,0),aL=safe(document.getElementById('aL').value,0);

  let avgGoalsHome=(golHome||0)/matchCount,avgConcedeHome=(kebHome||0)/matchCount;
  let avgGoalsAway=(golAway||0)/matchCount,avgConcedeAway=(kebAway||0)/matchCount;
  let lambdaHome=Math.max(0.05,(avgGoalsHome+avgConcedeAway)/2);
  let lambdaAway=Math.max(0.05,(avgGoalsAway+avgConcedeHome)/2);
  const formHome=((3*hW+1*hD)/Math.max(1,(hW+hD+hL)))/3;
  const formAway=((3*aW+1*aD)/Math.max(1,(aW+aD+aL)))/3;
  const formDiff=(formHome-formAway)||0;
  lambdaHome*=(1+0.25*formDiff);lambdaAway*=(1-0.25*formDiff);
  lambdaHome+=0.12;

  const M=computeMatrix(lambdaHome,lambdaAway,12,modelType);
  const ouProb=computeOUFromDist(M.totalDist,ouLine);
  const hdpProb=computeHDPFromMatrix(M.matrix,hdpLine);

  const fair123=fairifyOdds([oddsHome,oddsDraw,oddsAway]);
  const fairOU=fairifyOdds([overOdd,underOdd]);
  const fairHDP=fairifyOdds([hdpHomeOdd,hdpAwayOdd]);

  const wm=0.6,wk=0.4;
  function blend(mkt,mdl){if(mkt==null)return mdl;if(mdl==null)return mkt;return wm*mdl+wk*mkt;}
  const blended={home:blend(fair123[0],M.pHome),draw:blend(fair123[1],M.pDraw),away:blend(fair123[2],M.pAway),
    over:blend(fairOU[0],ouProb.over),under:blend(fairOU[1],ouProb.under),
    hdpHome:blend(fairHDP[0],hdpProb.ph),hdpAway:blend(fairHDP[1],hdpProb.pa)};

  function pct(x){return x==null?'--':(x*100).toFixed(1)+'%';}
  const tbody=document.getElementById('tbody');
  tbody.innerHTML=`<tr><td>Model</td><td>${pct(M.pHome)}</td><td>${pct(M.pDraw)}</td><td>${pct(M.pAway)}</td><td>${pct(ouProb.over)}</td><td>${pct(ouProb.under)}</td><td>${pct(hdpProb.ph)}</td><td>${pct(hdpProb.pa)}</td></tr>
  <tr><td>Market (fair)</td><td>${pct(fair123[0])}</td><td>${pct(fair123[1])}</td><td>${pct(fair123[2])}</td><td>${pct(fairOU[0])}</td><td>${pct(fairOU[1])}</td><td>${pct(fairHDP[0])}</td><td>${pct(fairHDP[1])}</td></tr>
  <tr><td>Blended</td><td>${pct(blended.home)}</td><td>${pct(blended.draw)}</td><td>${pct(blended.away)}</td><td>${pct(blended.over)}</td><td>${pct(blended.under)}</td><td>${pct(blended.hdpHome)}</td><td>${pct(blended.hdpAway)}</td></tr>`;
  document.getElementById('tbl').style.display='table';

  const entries=[
    {label:'üè† Home Win',model:M.pHome,market:fair123[0],blended:blended.home,odd:oddsHome},
    {label:'ü§ù Draw',model:M.pDraw,market:fair123[1],blended:blended.draw,odd:oddsDraw},
    {label:'üö© Away Win',model:M.pAway,market:fair123[2],blended:blended.away,odd:oddsAway},
    {label:`‚¨ÜÔ∏è Over ${ouLine}`,model:ouProb.over,market:fairOU[0],blended:blended.over,odd:overOdd},
    {label:`‚¨áÔ∏è Under ${ouLine}`,model:ouProb.under,market:fairOU[1],blended:blended.under,odd:underOdd},
    {label:`üìä HDP Home ${hdpLine}`,model:hdpProb.ph,market:fairHDP[0],blended:blended.hdpHome,odd:hdpHomeOdd},
    {label:`üìä HDP Away ${hdpLine}`,model:hdpProb.pa,market:fairHDP[1],blended:blended.hdpAway,odd:hdpAwayOdd}
  ].filter(e=>e.blended!=null);

  entries.sort((a,b)=>b.blended-a.blended);
  const top3=entries.slice(0,3);
  const recomDiv=document.getElementById('recom');
  let recomHTML='<strong>Top rekomendasi (Blended)</strong><hr>';
  top3.forEach((t,i)=>{recomHTML+=`<div class="good">${i+1}. ${t.label} ‚Äî ${(t.blended*100).toFixed(1)}%</div>`;});
  recomDiv.style.display='block';recomDiv.innerHTML=recomHTML;

  document.getElementById('output').innerText=`Lambda Home:${lambdaHome.toFixed(2)}, Lambda Away:${lambdaAway.toFixed(2)}\nModel 1X2: Home ${(M.pHome*100).toFixed(1)}% | Draw ${(M.pDraw*100).toFixed(1)}% | Away ${(M.pAway*100).toFixed(1)}%\nO/U ${ouLine}: Over ${(ouProb.over*100).toFixed(1)}% | Under ${(ouProb.under*100).toFixed(1)}%\nHDP ${hdpLine}: Home ${(hdpProb.ph*100).toFixed(1)}% | Away ${(hdpProb.pa*100).toFixed(1)}%`;
}
</script>
</body>
</html>
