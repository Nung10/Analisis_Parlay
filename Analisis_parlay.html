<!DOCTYPE html><html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Kalkulator HDP Advanced + Rekomendasi (Manual Input)</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{font-family:Arial,Helvetica,sans-serif;background:#f6f6f6;padding:16px}
.container{max-width:980px;margin:auto;background:#fff;padding:16px;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,.08)}
h2{text-align:center;margin:6px 0 12px}
label{display:block;margin-top:10px;font-weight:600}
.row{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
.row>div{flex:1 1 140px}
input,button,textarea{width:100%;padding:8px;border-radius:6px;border:1px solid #ccc;box-sizing:border-box}
button{margin-top:16px;background:#1976d2;color:#fff;border:none;border-radius:6px;font-size:16px;cursor:pointer}
.result{margin-top:12px;padding:12px;background:#f1f8e9;border-radius:6px;white-space:pre-wrap}
.table{width:100%;border-collapse:collapse;margin-top:10px}
.table td,.table th{border:1px solid #eee;padding:6px;text-align:center}
.reco-box{background:#fff7e6;border-left:4px solid #ffb300;padding:10px;margin-top:10px;border-radius:6px}
.reco-strong{background:#e8f5e9;color:#2e7d32;padding:8px;border-radius:6px;margin-top:8px}
.reco-good{background:#e3f2fd;color:#0d47a1;padding:8px;border-radius:6px;margin-top:8px}
.small{font-size:13px;color:#666;margin-top:6px}
</style>
</head>
<body>
<div class="container">
  <h2>Kalkulator HDP Advanced + Rekomendasi Terbaik</h2><label>Odds 1X2 (Home / Draw / Away)</label>

  <div class="row">
    <div><input id="oddsHome" type="number" step="0.01" placeholder="Home"></div>
    <div><input id="oddsDraw" type="number" step="0.01" placeholder="Draw"></div>
    <div><input id="oddsAway" type="number" step="0.01" placeholder="Away"></div>
  </div><label>Odds HDP (Home / Away)</label>

  <div class="row">
    <div><input id="hdpHome" type="number" step="0.01" placeholder="HDP Home"></div>
    <div><input id="hdpAway" type="number" step="0.01" placeholder="HDP Away"></div>
  </div><label>Odds Over/Under (Over / Under)</label>

  <div class="row">
    <div><input id="over" type="number" step="0.01" placeholder="Over"></div>
    <div><input id="under" type="number" step="0.01" placeholder="Under"></div>
  </div><label>Total Gol & Kebobolan (jumlah gol di X laga terakhir)</label>

  <div class="row">
    <div><input id="golHome" type="number" placeholder="Total gol Home (mis. 8)"></div>
    <div><input id="kebHome" type="number" placeholder="Total kebobolan Home"></div>
    <div><input id="golAway" type="number" placeholder="Total gol Away"></div>
    <div><input id="kebAway" type="number" placeholder="Total kebobolan Away"></div>
  </div>
  <div class="row">
    <div><input id="matchCount" type="number" value="5" min="1" placeholder="Jumlah laga (mis.5)"></div>
    <div style="flex:2"><input id="bankroll" type="number" value="100" min="1" placeholder="Bankroll (untuk Kelly)"></div>
  </div><label>Head-to-Head (H2H) — tulis manual, contoh: Home 2-1 Away, Away 1-1 Home</label>

  <textarea id="h2hText" rows="3" placeholder="Contoh: Home 2-1 Away, Away 1-1 Home"></textarea>  <div class="small">Blending weight: Model Poisson 0.6, Market fair 0.4 (ubah di kode bila perlu)</div><button id="btnAnalisis">Analisis & Rekomendasi</button>

  <div id="hasil" class="result">Hasil akan tampil di sini</div>  <table class="table" id="tbl" style="display:none">
    <thead><tr><th>Metode</th><th>Home</th><th>Draw</th><th>Away</th><th>Over</th><th>Under</th><th>BTTS</th></tr></thead>
    <tbody id="tbody"></tbody>
  </table>  <div id="rekomContainer" class="reco-box" style="display:none">
    <strong>Rekomendasi Terbaik</strong>
    <div id="rekom1"></div>
    <div id="rekom2"></div>
    <div id="rekom3"></div>
    <div id="rekomAll" style="margin-top:8px;font-size:13px;color:#444"></div>
  </div><canvas id="chart" height="160" style="margin-top:12px"></canvas>

</div><script>
// Semua fungsi helper tetap sama seperti versi sebelumnya (Poisson, Kelly, computeRecommendations)
// (Kode helper tidak dipotong di sini demi kejelasan)

// ... (fungsi factorial, poissonP, goalDist, computeMatchProbs, fairifyOddsArray, fairifyTwo, kellyFraction, valuePP, computeRecommendations) ...

let chart=null;
function analyzeAll(){
  const oh = parseFloat(document.getElementById('oddsHome').value);
  const od = parseFloat(document.getElementById('oddsDraw').value);
  const oa = parseFloat(document.getElementById('oddsAway').value);
  const hh = parseFloat(document.getElementById('hdpHome').value);
  const ha = parseFloat(document.getElementById('hdpAway').value);
  const ov = parseFloat(document.getElementById('over').value);
  const un = parseFloat(document.getElementById('under').value);
  const golHome = parseFloat(document.getElementById('golHome').value) || 0;
  const kebHome = parseFloat(document.getElementById('kebHome').value) || 0;
  const golAway = parseFloat(document.getElementById('golAway').value) || 0;
  const kebAway = parseFloat(document.getElementById('kebAway').value) || 0;
  let matches = parseInt(document.getElementById('matchCount').value) || 5;
  const bankroll = parseFloat(document.getElementById('bankroll').value) || 100;

  if(matches <= 0) matches = 5;

  const avgGoalsHome = golHome / matches;
  const avgConcedeAway = kebAway / matches;
  const avgGoalsAway = golAway / matches;
  const avgConcedeHome = kebHome / matches;
  let lambdaHome = (avgGoalsHome + avgConcedeAway) / 2;
  let lambdaAway = (avgGoalsAway + avgConcedeHome) / 2;
  lambdaHome = Math.max(0.2, lambdaHome);
  lambdaAway = Math.max(0.2, lambdaAway);

  const match = computeMatchProbs(lambdaHome, lambdaAway, 10);
  const model = {
    home: match.pHome,
    draw: match.pDraw,
    away: match.pAway,
    overProb: (function(){ if(isNaN(ov)) return null; let p=0; for(let t=Math.round(ov)+1;t<match.totalDist.length;t++) p+=match.totalDist[t]; return p; })(),
    underProb: (function(){ if(isNaN(un)) return null; let p=0; for(let t=0;t<=Math.round(un);t++) p+=match.totalDist[t]; return p; })(),
    btts: match.pBoth
  };

  const market = {};
  if(!isNaN(oh) && !isNaN(od) && !isNaN(oa)){
    const fair = fairifyOddsArray([oh,od,oa]);
    market.home = fair[0]; market.draw = fair[1]; market.away = fair[2];
  }
  if(!isNaN(ov) && !isNaN(un)){
    const f = fairifyTwo(ov,un);
    market.over = f[0]; market.under = f[1];
  }
  if(!isNaN(hh) && !isNaN(ha)){
    const f2 = fairifyTwo(hh,ha);
    market.hdpHome = f2[0]; market.hdpAway = f2[1];
  }

  const wm = 0.6, wk = 0.4;
  function blend(mkt, mdl){ return (mkt==null)?mdl:(mdl==null)?mkt: wm*mdl + wk*mkt; }
  const blended = {
    home: blend(market.home, model.home),
    draw: blend(market.draw, model.draw),
    away: blend(market.away, model.away),
    over: blend(market.over, model.overProb),
    under: blend(market.under, model.underProb),
    hdpHome: market.hdpHome,
    hdpAway: market.hdpAway,
    btts: model.btts
  };

  const body = document.getElementById('tbody'); body.innerHTML = '';
  function pct(x){ return x==null ? '--' : (x*100).toFixed(1)+'%'; }
  body.innerHTML += `<tr><td>Model</td><td>${pct(model.home)}</td><td>${pct(model.draw)}</td><td>${pct(model.away)}</td>
    <td>${pct(model.overProb)}</td><td>${pct(model.underProb)}</td><td>${pct(model.btts)}</td></tr>`;
  body.innerHTML += `<tr><td>Market (fair)</td><td>${pct(market.home)}</td><td>${pct(market.draw)}</td><td>${pct(market.away)}</td>
    <td>${pct(market.over)}</td><td>${pct(market.under)}</td><td>--</td></tr>`;
  body.innerHTML += `<tr><td>Blended</td><td>${pct(blended.home)}</td><td>${pct(blended.draw)}</td><td>${pct(blended.away)}</td>
    <td>${pct(blended.over)}</td><td>${pct(blended.under)}</td><td>${pct(blended.btts)}</td></tr>`;
  document.getElementById('tbl').style.display = 'table';

  const oddsObj = { home: oh, draw: od, away: oa, over: ov, under: un, hdpHome: hh, hdpAway: ha };
  const recs = computeRecommendations(market, blended, oddsObj);

  const rcont = document.getElementById('rekomContainer'); rcont.style.display = 'block';
  function showRec(slotId, recObj){
    const el = document.getElementById(slotId);
    if(!recObj){ el.innerHTML = '<div style="color:#666">Tidak ada rekomendasi</div>'; return; }
    const valNum = parseFloat(recObj.valuePP) || 0;
    const probNum = parseFloat(recObj.prob) || 0;
    const scoreType = (valNum >= 5) ? 'Strong' : (probNum > 55 ? 'Good' : 'Watch');
    const cls = scoreType==='Strong' ? 'reco-strong' : 'reco-good';
    el.innerHTML = `<div class="${cls}"><b>${recObj.pick}</b> — Prob ${recObj.prob} — Odds ${recObj.odds} — Kelly ${recObj.kelly} — ${recObj.reason}</div>`;
  }

  showRec('rekom1', recs.best1x2);
  showRec('rekom2', recs.bestHdp);
  showRec('rekom3', recs.bestOu);
  document.getElementById('rekomAll').textContent = 'All candidates: ' + recs.all.map(a=>`${a.label} ${a.prob} (${a.valuePP})`).join(' | ');

  if(chart) chart.destroy();
  chart = new Chart(document.getElementById('chart'), {
    type: 'bar',
    data: {
      labels: ['Home','Draw','Away'],
      datasets: [
        { label: 'Market', data: [market.home||0, market.draw||0, market.away||0], backgroundColor: '#FFC107' },
        { label: 'Model', data: [model.home, model.draw, model.away], backgroundColor: '#4CAF50' },
        { label: 'Blended', data: [blended.home, blended.draw, blended.away], backgroundColor: '#1976D2' }
      ]
    },
    options: { responsive:true, plugins:{legend:{position:'bottom'}}, scales:{y:{beginAtZero:true}} }
  });

  document.getElementById('hasil').textContent =
    `Lambda Home: ${lambdaHome.toFixed(2)} | Lambda Away: ${lambdaAway.toFixed(2)}\nH2H Manual:\n${document.getElementById('h2hText').value || '-'}\n(Blended = 0.6×Model + 0.4×Market)`;
}

document.getElementById('btnAnalisis').addEventListener('click', analyzeAll);
</script></body>
</html>
