<!DOCTYPE html><html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Kalkulator HDP Advanced + Rekomendasi (Update BTTS + Performa)</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{font-family:Arial,Helvetica,sans-serif;background:#f6f6f6;padding:16px}
.container{max-width:980px;margin:auto;background:#fff;padding:16px;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,.08)}
h2{text-align:center;margin:6px 0 12px}
label{display:block;margin-top:10px;font-weight:600}
.row{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
.row>div{flex:1 1 140px}
input,button,textarea{width:100%;padding:8px;border-radius:6px;border:1px solid #ccc;box-sizing:border-box}
button{margin-top:16px;background:#1976d2;color:#fff;border:none;border-radius:6px;font-size:16px;cursor:pointer}
.result{margin-top:12px;padding:12px;background:#f1f8e9;border-radius:6px;white-space:pre-wrap}
.table{width:100%;border-collapse:collapse;margin-top:10px}
.table td,.table th{border:1px solid #eee;padding:6px;text-align:center}
.reco-box{background:#fff7e6;border-left:4px solid #ffb300;padding:10px;margin-top:10px;border-radius:6px}
.reco-strong{background:#e8f5e9;color:#2e7d32;padding:8px;border-radius:6px;margin-top:8px}
.reco-good{background:#e3f2fd;color:#0d47a1;padding:8px;border-radius:6px;margin-top:8px}
.small{font-size:13px;color:#666;margin-top:6px}
.flex-between{display:flex;justify-content:space-between;align-items:center}
.perf-table{width:100%;border-collapse:collapse;margin-top:8px}
.perf-table td,.perf-table th{border:1px solid #f0f0f0;padding:6px;text-align:left}
</style>
</head>
<body>
<div class="container">
  <h2>Kalkulator HDP Advanced + Rekomendasi</h2><label>Odds 1X2 (Home / Draw / Away)</label>

  <div class="row">
    <div><input id="oddsHome" type="number" step="0.01" placeholder="Home"></div>
    <div><input id="oddsDraw" type="number" step="0.01" placeholder="Draw"></div>
    <div><input id="oddsAway" type="number" step="0.01" placeholder="Away"></div>
  </div><label>Odds HDP (Home / Away)</label>

  <div class="row">
    <div><input id="hdpHome" type="number" step="0.01" placeholder="HDP Home"></div>
    <div><input id="hdpAway" type="number" step="0.01" placeholder="HDP Away"></div>
  </div><label>Odds Over/Under (Over / Under)</label>

  <div class="row">
    <div><input id="over" type="number" step="0.01" placeholder="Over"></div>
    <div><input id="under" type="number" step="0.01" placeholder="Under"></div>
  </div><label>Odds BTTS (Yes / No)</label>

  <div class="row">
    <div><input id="bttsYes" type="number" step="0.01" placeholder="BTTS Yes"></div>
    <div><input id="bttsNo" type="number" step="0.01" placeholder="BTTS No"></div>
  </div><label>Total Gol & Kebobolan (X laga terakhir)</label>

  <div class="row">
    <div><input id="golHome" type="number" placeholder="Total gol Home (mis.8)"></div>
    <div><input id="kebHome" type="number" placeholder="Total kebobolan Home"></div>
    <div><input id="golAway" type="number" placeholder="Total gol Away"></div>
    <div><input id="kebAway" type="number" placeholder="Total kebobolan Away"></div>
  </div>
  <div class="row">
    <div><input id="matchCount" type="number" value="5" min="1" placeholder="Jumlah laga"></div>
    <div style="flex:2"><input id="bankroll" type="number" value="100" min="1" placeholder="Bankroll (untuk Kelly)"></div>
  </div><label>Performa Tim (W–D–L)</label>

  <div class="row">
    <div><input id="perfHomeW" type="number" placeholder="Home Win"></div>
    <div><input id="perfHomeD" type="number" placeholder="Home Draw"></div>
    <div><input id="perfHomeL" type="number" placeholder="Home Lose"></div>
    <div><input id="perfAwayW" type="number" placeholder="Away Win"></div>
    <div><input id="perfAwayD" type="number" placeholder="Away Draw"></div>
    <div><input id="perfAwayL" type="number" placeholder="Away Lose"></div>
  </div><label>Head-to-Head (H2H) — contoh: Home 2-1 Away, Away 1-1 Home</label>

  <textarea id="h2hText" rows="3" placeholder="Contoh: Home 2-1 Away, Away 1-1 Home"></textarea>  <div class="flex-between">
    <div class="small">Blending weight: Model Poisson 0.6, Market fair 0.4 (ubah di kode bila perlu)</div>
    <button id="btnAnalisis">Analisis & Rekomendasi</button>
  </div>  <div id="hasil" class="result">Hasil akan tampil di sini</div>  <table class="table" id="tbl" style="display:none">
    <thead><tr><th>Metode</th><th>Home</th><th>Draw</th><th>Away</th><th>Over</th><th>Under</th><th>BTTS Yes</th><th>BTTS No</th></tr></thead>
    <tbody id="tbody"></tbody>
  </table>  <div id="rekomContainer" class="reco-box" style="display:none">
    <strong>Rekomendasi Terbaik</strong>
    <div id="rekom1"></div>
    <div id="rekom2"></div>
    <div id="rekom3"></div>
    <div id="rekom4"></div>
    <div id="rekomAll" style="margin-top:8px;font-size:13px;color:#444"></div>
  </div><canvas id="chart" height="160" style="margin-top:12px"></canvas>

  <div id="performaBox" class="small"></div>
</div><script>
/* -- helper functions -- */
function factorial(n){ if(n<=1) return 1; let f=1; for(let i=2;i<=n;i++) f*=i; return f; }
function poissonP(k, lambda){ return Math.exp(-lambda)*Math.pow(lambda,k)/factorial(k); }
function goalDist(lambda, maxGoals=10){ const arr=[]; let sum=0; for(let k=0;k<=maxGoals;k++){ const p=poissonP(k, lambda); arr.push(p); sum+=p; } if(sum<1) arr[arr.length-1]+=1-sum; return arr; }
function computeMatchProbs(lambdaHome, lambdaAway, maxG=10){
  const distH=goalDist(lambdaHome,maxG);
  const distA=goalDist(lambdaAway,maxG);
  let pHome=0,pDraw=0,pAway=0,pBoth=0;
  const totalDist=Array(maxG*2+1).fill(0);
  for(let i=0;i<=maxG;i++){
    for(let j=0;j<=maxG;j++){
      const p=distH[i]*distA[j];
      if(i>j) pHome+=p; else if(i===j) pDraw+=p; else pAway+=p;
      if(i>0&&j>0) pBoth+=p;
      totalDist[i+j]+=p;
    }
  }
  return {pHome,pDraw,pAway,pBoth,totalDist};
}
function safeParseFloat(v){ const n=parseFloat(v); return isNaN(n)?null:n; }
function fairifyTwo(a,b){ const ia=safeParseFloat(a), ib=safeParseFloat(b); if(ia===null||ib===null||ia<=0||ib<=0) return [null,null]; const ra=1/ia, rb=1/ib; const s=ra+rb; return [ra/s, rb/s]; }
function fairifyOddsArray(arr){ const v=arr.map(o=>safeParseFloat(o)); if(v.some(x=>x===null||x<=0)) return [null,null,null]; const imps=v.map(o=>1/o); const sum=imps.reduce((a,b)=>a+b,0); return imps.map(i=>i/sum); }
function kellyFraction(p, odd){ if(p==null||odd==null) return 0; const b=odd-1; if(b<=0) return 0; const k=(b*p-(1-p))/b; return Math.max(0,k); }
function valuePP(blend, marketFair){ if(blend==null||marketFair==null) return null; return (blend-marketFair)*100; }

/* compute recommendations */
function computeRecommendations(market, blended, oddsObj){
  const candidates=[];
  function push(key,label,blend,marketFair,odd){ if(blend==null) return; const val=(marketFair!=null)?valuePP(blend,marketFair):null; const kelly=odd?kellyFraction(blend,odd):0; candidates.push({key,label,blend,marketFair,odd,val,kelly}); }
  push('home','1X2 Home',blended.home,market.home,oddsObj.home);
  push('draw','1X2 Draw',blended.draw,market.draw,oddsObj.draw);
  push('away','1X2 Away',blended.away,market.away,oddsObj.away);
  push('over','Over',blended.over,market.over,oddsObj.over);
  push('under','Under',blended.under,market.under,oddsObj.under);
  push('hdpHome','HDP Home',blended.hdpHome,market.hdpHome,oddsObj.hdpHome);
  push('hdpAway','HDP Away',blended.hdpAway,market.hdpAway,oddsObj.hdpAway);
  push('bttsYes','BTTS Yes',blended.bttsYes,market.bttsYes,oddsObj.bttsYes);
  push('bttsNo','BTTS No',blended.bttsNo,market.bttsNo,oddsObj.bttsNo);

  candidates.forEach(c=>{ let score=0; if(c.val!==null&&c.val>=5) score+=100; if(c.blend!==null&&c.blend>0.55) score+=60; score+=(c.kelly||0)*100; score+=(c.blend||0)*10; c.score=score; });

  function best(keys){ const list=candidates.filter(c=>keys.includes(c.key)); if(list.length===0) return null; list.sort((a,b)=>b.score-a.score); return list[0]; }
  const best1x2 = best(['home','draw','away']);
  const bestHdp = best(['hdpHome','hdpAway']);
  const bestOu = best(['over','under']);
  const bestBtts = best(['bttsYes','bttsNo']);

  function formatRec(c){ if(!c) return null; const reasonParts=[]; if(c.val!==null && c.val>=5) reasonParts.push(`Value +${c.val.toFixed(1)}pp`); if(c.blend!==null && c.blend>0.55) reasonParts.push(`Blended ${(c.blend*100).toFixed(1)}%`); if(reasonParts.length===0) reasonParts.push(`Blended ${(c.blend*100).toFixed(1)}%`); const kellyPct = (c.kelly*100).toFixed(1) + '%'; return { pick: c.label, odds: c.odd || '--', prob: (c.blend*100).toFixed(1)+'%', valuePP: c.val!==null?c.val.toFixed(1)+' pp':'--', kelly: kellyPct, reason: reasonParts.join(' & ') }; }

  return { best1x2: formatRec(best1x2), bestHdp: formatRec(bestHdp), bestOu: formatRec(bestOu), bestBtts: formatRec(bestBtts), all: candidates.sort((a,b)=>b.score-a.score).map(c=>({ label: c.label, prob: (c.blend*100).toFixed(1)+'%', valuePP: c.val!==null?c.val.toFixed(1)+' pp':'--', kelly: (c.kelly*100).toFixed(1)+'%' })) };
}

/* main analyze function */
let chart=null;
function analyzeAll(){
  // read inputs
  const oh = safeParseFloat(document.getElementById('oddsHome').value);
  const od = safeParseFloat(document.getElementById('oddsDraw').value);
  const oa = safeParseFloat(document.getElementById('oddsAway').value);
  const hh = safeParseFloat(document.getElementById('hdpHome').value);
  const ha = safeParseFloat(document.getElementById('hdpAway').value);
  const ov = safeParseFloat(document.getElementById('over').value);
  const un = safeParseFloat(document.getElementById('under').value);
  const by = safeParseFloat(document.getElementById('bttsYes').value);
  const bn = safeParseFloat(document.getElementById('bttsNo').value);

  const golHome = parseFloat(document.getElementById('golHome').value) || 0;
  const kebHome = parseFloat(document.getElementById('kebHome').value) || 0;
  const golAway = parseFloat(document.getElementById('golAway').value) || 0;
  const kebAway = parseFloat(document.getElementById('kebAway').value) || 0;
  let matches = parseInt(document.getElementById('matchCount').value) || 5;
  if(matches <= 0) matches = 5;

  const perfHomeW = parseInt(document.getElementById('perfHomeW').value) || 0;
  const perfHomeD = parseInt(document.getElementById('perfHomeD').value) || 0;
  const perfHomeL = parseInt(document.getElementById('perfHomeL').value) || 0;
  const perfAwayW = parseInt(document.getElementById('perfAwayW').value) || 0;
  const perfAwayD = parseInt(document.getElementById('perfAwayD').value) || 0;
  const perfAwayL = parseInt(document.getElementById('perfAwayL').value) || 0;

  // model lambdas
  const avgGoalsHome = golHome / matches;
  const avgConcedeAway = kebAway / matches;
  const avgGoalsAway = golAway / matches;
  const avgConcedeHome = kebHome / matches;
  let lambdaHome = (avgGoalsHome + avgConcedeAway) / 2;
  let lambdaAway = (avgGoalsAway + avgConcedeHome) / 2;
  lambdaHome = Math.max(0.2, lambdaHome);
  lambdaAway = Math.max(0.2, lambdaAway);

  const match = computeMatchProbs(lambdaHome, lambdaAway, 10);
  const model = {
    home: match.pHome,
    draw: match.pDraw,
    away: match.pAway,
    overProb: (function(){ if(ov==null) return null; let p=0; for(let t=Math.round(ov)+1; t<match.totalDist.length; t++) p+=match.totalDist[t]; return p; })(),
    underProb: (function(){ if(un==null) return null; let p=0; for(let t=0; t<=Math.round(un); t++) p+=match.totalDist[t]; return p; })(),
    btts: match.pBoth
  };

  // market fair probabilities
  const fair123 = fairifyOddsArray([oh, od, oa]);
  const f_ou = fairifyTwo(ov, un);
  const f_hdp = fairifyTwo(hh, ha);
  const f_btts = fairifyTwo(by, bn);
  const market = {};
  if(fair123[0] !== null){ market.home = fair123[0]; market.draw = fair123[1]; market.away = fair123[2]; }
  if(f_ou[0] !== null){ market.over = f_ou[0]; market.under = f_ou[1]; }
  if(f_hdp[0] !== null){ market.hdpHome = f_hdp[0]; market.hdpAway = f_hdp[1]; }
  if(f_btts[0] !== null){ market.bttsYes = f_btts[0]; market.bttsNo = f_btts[1]; }

  // blend model + market
  const wm = 0.6, wk = 0.4;
  function blend(mkt, mdl){ return (mkt==null)?mdl:(mdl==null)?mkt: wm*mdl + wk*mkt; }
  const blended = {
    home: blend(market.home, model.home),
    draw: blend(market.draw, model.draw),
    away: blend(market.away, model.away),
    over: blend(market.over, model.overProb),
    under: blend(market.under, model.underProb),
    hdpHome: market.hdpHome,
    hdpAway: market.hdpAway,
    bttsYes: blend(market.bttsYes, model.btts),
    bttsNo: blend(market.bttsNo, 1 - model.btts)
  };

  // populate table
  const body = document.getElementById('tbody'); body.innerHTML = '';
  function pct(x){ return x==null ? '--' : (x*100).toFixed(1)+'%'; }
  body.innerHTML += `<tr><td>Model</td><td>${pct(model.home)}</td><td>${pct(model.draw)}</td><td>${pct(model.away)}</td><td>${pct(model.overProb)}</td><td>${pct(model.underProb)}</td><td>${pct(model.btts)}</td><td>${pct(1-model.btts)}</td></tr>`;
  body.innerHTML += `<tr><td>Market (fair)</td><td>${pct(market.home)}</td><td>${pct(market.draw)}</td><td>${pct(market.away)}</td><td>${pct(market.over)}</td><td>${pct(market.under)}</td><td>${pct(market.bttsYes)}</td><td>${pct(market.bttsNo)}</td></tr>`;
  body.innerHTML += `<tr><td>Blended</td><td>${pct(blended.home)}</td><td>${pct(blended.draw)}</td><td>${pct(blended.away)}</td><td>${pct(blended.over)}</td><td>${pct(blended.under)}</td><td>${pct(blended.bttsYes)}</td><td>${pct(blended.bttsNo)}</td></tr>`;
  document.getElementById('tbl').style.display = 'table';

  // compute recommendations
  const oddsObj = { home: oh, draw: od, away: oa, over: ov, under: un, hdpHome: hh, hdpAway: ha, bttsYes: by, bttsNo: bn };
  const recs = computeRecommendations(market, blended, oddsObj);

  // show recommendations
  const rcont = document.getElementById('rekomContainer'); rcont.style.display = 'block';
  function renderRec(elId, recObj){ const el = document.getElementById(elId); if(!recObj){ el.innerHTML = '<div style="color:#666">Tidak ada rekomendasi</div>'; return; } const valNum = parseFloat(recObj.valuePP) || 0; const probNum = parseFloat(recObj.prob) || 0; const scoreType = (valNum >= 5) ? 'Strong' : (probNum > 55 ? 'Good' : 'Watch'); const cls = scoreType === 'Strong' ? 'reco-strong' : 'reco-good'; el.innerHTML = `<div class="${cls}"><b>${recObj.pick}</b> — Prob ${recObj.prob} — Odds ${recObj.odds} — Kelly ${recObj.kelly} — ${recObj.reason}</div>`; }
  renderRec('rekom1', recs.best1x2);
  renderRec('rekom2', recs.bestHdp);
  renderRec('rekom3', recs.bestOu);
  renderRec('rekom4', recs.bestBtts);
  document.getElementById('rekomAll').textContent = 'All candidates: ' + recs.all.map(a=>`${a.label} ${a.prob} (${a.valuePP})`).join(' | ');

  // chart for 1X2
  if(chart) chart.destroy();
  chart = new Chart(document.getElementById('chart'), {
    type: 'bar',
    data: {
      labels: ['Home','Draw','Away'],
      datasets: [
        { label: 'Market', data: [market.home||0, market.draw||0, market.away||0] },
        { label: 'Model', data: [model.home||0, model.draw||0, model.away||0] },
        { label: 'Blended', data: [blended.home||0, blended.draw||0, blended.away||0] }
      ]
    },
    options: { responsive:true, plugins:{legend:{position:'bottom'}}, scales:{y:{beginAtZero:true, ticks:{callback:function(v){return (v*100).toFixed(0)+'%';}}}} }
  });

  // performa tim
  function makePerfRow(w,d,l){ const total = w+d+l; if(total===0) return {win:'--', draw:'--', lose:'--'}; return { win: (w/total*100).toFixed(1)+'%', draw: (d/total*100).toFixed(1)+'%', lose: (l/total*100).toFixed(1)+'%'}; }
  const ph = makePerfRow(perfHomeW, perfHomeD, perfHomeL);
  const pa = makePerfRow(perfAwayW, perfAwayD, perfAwayL);
  document.getElementById('performaBox').innerHTML = `<div style="margin-top:12px"><strong>Performa Tim</strong><table class="perf-table"><thead><tr><th>Forma Tim</th><th>Win</th><th>Draw</th><th>Lose</th></tr></thead><tbody><tr><td>Home</td><td>${ph.win}</td><td>${ph.draw}</td><td>${ph.lose}</td></tr><tr><td>Away</td><td>${pa.win}</td><td>${pa.draw}</td><td>${pa.lose}</td></tr></tbody></table></div>`;

  // summary text
  document.getElementById('hasil').textContent = `Lambda Home: ${lambdaHome.toFixed(2)} | Lambda Away: ${lambdaAway.toFixed(2)}
H2H Manual:
${document.getElementById('h2hText').value || '-'}
(Blended = 0.6×Model + 0.4×Market)`;
}

// bind
document.getElementById('btnAnalisis').addEventListener('click', analyzeAll);
</script></body>
</html>
