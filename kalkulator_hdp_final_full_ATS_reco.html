<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Kalkulator HDP ‚Äî Auto Lambda (Performa + H2H)</title>
<style>
body{font-family:Arial,Helvetica,sans-serif;margin:0;padding:18px;background:#f4f6f9;color:#111}
.wrap{max-width:1200px;margin:12px auto;padding:16px;background:#fff;border-radius:10px;box-shadow:0 8px 28px rgba(10,20,30,0.06)}
h1{margin:0 0 8px;font-size:20px}
label{display:block;font-weight:700;margin-top:8px}
input,select,button{width:100%;padding:8px;border-radius:6px;border:1px solid #d6dde6;box-sizing:border-box}
button{background:#1976d2;color:#fff;border:none;cursor:pointer;font-weight:700}
.result{margin-top:12px;padding:12px;background:#eef7ff;border-radius:8px;white-space:pre-wrap}
.reco{margin-top:12px;padding:12px;background:#e8fbe8;border-radius:8px;white-space:pre-wrap;font-weight:700}
canvas{width:100%;height:240px;background:#fff;border-radius:8px;border:1px solid #eef3f8;margin-top:8px}
</style>
</head>
<body>
<div class="wrap">
  <h1>Kalkulator HDP ‚Äî Auto Lambda (ATS + O/U + Value Bet)</h1>

  <label>Pilih Liga / Kompetisi</label>
  <select id="leagueSelect"></select>

  <label>League Avg</label>
  <input id="leagueAvg" type="number" step="0.01" value="2.90">

  <h3>üìä Performa Tim (GF/GA per match)</h3>
  <label>Home GF</label><input id="perfGFH" type="number" step="0.01" value="1.5">
  <label>Home GA</label><input id="perfGAH" type="number" step="0.01" value="1.2">
  <label>Away GF</label><input id="perfGFA" type="number" step="0.01" value="1.3">
  <label>Away GA</label><input id="perfGAA" type="number" step="0.01" value="1.4">

  <h3>ü§ù H2H (rata2 gol di pertemuan terakhir)</h3>
  <label>H2H GF Home</label><input id="h2hGFH" type="number" step="0.01" value="1.2">
  <label>H2H GF Away</label><input id="h2hGFA" type="number" step="0.01" value="1.0">

  <h3>üé≤ Odds Pasar</h3>
  <label>HDP (Line / Odds Home / Odds Away)</label>
  <input id="hdpLine" type="number" step="0.25" placeholder="Line (mis. -0.75)">
  <input id="hdpHomeOdd" type="number" step="0.01" placeholder="HDP Home Odd">
  <input id="hdpAwayOdd" type="number" step="0.01" placeholder="HDP Away Odd">

  <label>Over/Under (Line / Odds Over / Odds Under)</label>
  <input id="ouLine" type="number" step="0.25" placeholder="Line (mis. 2.75)">
  <input id="overOdd" type="number" step="0.01" placeholder="Over Odd">
  <input id="underOdd" type="number" step="0.01" placeholder="Under Odd">

  <label>Threshold Value Bet (%)</label>
  <input id="threshold" type="number" step="0.01" value="0.07">

  <button onclick="analyze()">Analisis & Rekomendasi</button>

  <div id="output" class="result"></div>
  <div id="recommendation" class="reco"></div>
  <canvas id="distChart"></canvas>
</div>


<script>
// --- League averages ---
const leagueAvgGoals = {
  // Liga utama
  "Premier League": 2.65,
  "EFL Championship": 2.45,
  "La Liga": 2.62,
  "Serie A": 2.56,
  "Bundesliga": 3.14,
  "Ligue 1": 2.96,
  "Eredivisie": 2.98,
  "Swiss Super League": 3.33,
  "Denmark Superliga": 3.27,
  "Turkey S√ºper Lig": 2.94,
  "Portugal Primeira Liga": 2.87,
  "Poland Ekstraklasa": 2.85,
  "Norway Eliteserien": 2.83,
  "Sweden Allsvenskan": 2.83,
  "Iceland √örvalsdeild": 3.62,
  "Ireland Premier Division": 2.26,
  "Russia Premier League": 2.70,
  "Japan J.League": 2.67,
  "Saudi Pro League": 2.97,

  // UEFA
  "UEFA Champions League": 3.10,
  "UEFA Europa League": 2.90,
  "UEFA Conference League": 2.71,

  // Piala Domestik
  "FA Cup": 3.2,
  "EFL Cup (Carabao Cup)": 3.1,
  "Copa del Rey": 2.9,
  "Coppa Italia": 3.0,
  "DFB Pokal": 4.19,
  "Coupe de France": 3.1,
  "KNVB Cup": 3.8,
  "Ta√ßa de Portugal": 2.9,
  "Swiss Cup": 3.5,
  "DBU Pokalen": 4.0,
  "Svenska Cupen": 3.2,
  "Norwegian Cup": 3.7,
  "Suomen Cup": 4.0,
  "Icelandic Cup": 5.5,
  "Greek Cup": 2.3,
  "Turkish Cup": 3.0,
  "Russian Cup": 2.7,
  "Cupa Rom√¢niei": 3.5,
  "Polish Cup": 2.9,
  "Croatian Cup": 3.1,
  "Latvian Cup": 4.9,
  "Estonian Cup": 4.5,
  "Emperor's Cup": 3.4,
  "J.League Cup": 2.8,
  "King's Cup (Saudi)": 3.0
};
for(const k in leagueAvgGoals){
  const opt=document.createElement("option"); opt.value=k; opt.textContent=k;
  document.getElementById("leagueSelect").appendChild(opt);
}
document.getElementById("leagueSelect").addEventListener("change",()=>{
  const v=leagueAvgGoals[document.getElementById("leagueSelect").value];
  if(v) document.getElementById("leagueAvg").value=v;
});

// --- Helper ---
function factorial(n){return n<=1?1:n*factorial(n-1);}
function poisson(k,lambda){return Math.exp(-lambda)*Math.pow(lambda,k)/factorial(k);}
function pct(x){return (x*100).toFixed(1)+"%";}

// --- Distribusi Poisson ---
function computeMatrix(lambdaH,lambdaA,maxGoals=10){
  const matrix={}; const totalDist=[];
  for(let i=0;i<=maxGoals;i++){
    for(let j=0;j<=maxGoals;j++){
      const p=poisson(i,lambdaH)*poisson(j,lambdaA);
      matrix[`${i}-${j}`]=p;
      totalDist[i+j]=(totalDist[i+j]||0)+p;
    }
  }
  return {matrix,totalDist};
}

// --- Asian Handicap ---
function evalHDP(matrix,line){
  if(Math.abs(line*4)%2!==0){
    const l1=Math.floor(line*2)/2, l2=l1+0.5;
    const r1=evalHDP(matrix,l1), r2=evalHDP(matrix,l2);
    let comb={}; for(const k in r1) comb[k]=(r1[k]+r2[k])/2; return comb;
  }
  let fullWin=0,halfWin=0,push=0,halfLoss=0,fullLoss=0;
  for(const key in matrix){
    const p=matrix[key]; const [h,a]=key.split("-").map(Number);
    const diff=h-a+line;
    if(diff>0.5) fullWin+=p; else if(diff===0.5) halfWin+=p;
    else if(diff===0) push+=p; else if(diff===-0.5) halfLoss+=p;
    else if(diff<-0.5) fullLoss+=p;
  }
  return {fullWin,halfWin,push,halfLoss,fullLoss};
}

// --- Asian O/U ---
function evalOU(totalDist,line){
  if(Math.abs(line*4)%2!==0){
    const l1=Math.floor(line*2)/2, l2=l1+0.5;
    const r1=evalOU(totalDist,l1), r2=evalOU(totalDist,l2);
    let comb={}; for(const k in r1) comb[k]=(r1[k]+r2[k])/2; return comb;
  }
  let over=0,under=0,push=0,halfOver=0,halfUnder=0;
  for(let g=0;g<totalDist.length;g++){
    const p=totalDist[g]||0, diff=g-line;
    if(diff>0.5) over+=p; else if(diff===0.5) halfOver+=p;
    else if(diff===0) push+=p; else if(diff===-0.5) halfUnder+=p;
    else if(diff<-0.5) under+=p;
  }
  return {over,under,push,halfOver,halfUnder};
}

// --- Main ---
function analyze(){
  const leagueAvg=parseFloat(document.getElementById("leagueAvg").value)||2.7;

  // Performa & H2H
  const perfGFH=parseFloat(document.getElementById("perfGFH").value)||1.5;
  const perfGAH=parseFloat(document.getElementById("perfGAH").value)||1.2;
  const perfGFA=parseFloat(document.getElementById("perfGFA").value)||1.3;
  const perfGAA=parseFloat(document.getElementById("perfGAA").value)||1.4;
  const h2hGFH=parseFloat(document.getElementById("h2hGFH").value)||1.2;
  const h2hGFA=parseFloat(document.getElementById("h2hGFA").value)||1.0;

  // Lambda otomatis
  let lambdaH=leagueAvg*(perfGFH/leagueAvg)*(perfGAA/leagueAvg)*(Math.pow(h2hGFH/leagueAvg,0.7));
  let lambdaA=leagueAvg*(perfGFA/leagueAvg)*(perfGAH/leagueAvg)*(Math.pow(h2hGFA/leagueAvg,0.7));

  const M=computeMatrix(lambdaH,lambdaA,10);

  const hdpLine=parseFloat(document.getElementById("hdpLine").value)||0;
  const hdp=evalHDP(M.matrix,hdpLine);

  const ouLine=parseFloat(document.getElementById("ouLine").value)||2.5;
  const ou=evalOU(M.totalDist,ouLine);

  const overOdd=parseFloat(document.getElementById("overOdd").value)||2.0;
  const underOdd=parseFloat(document.getElementById("underOdd").value)||2.0;
  const hdpHO=parseFloat(document.getElementById("hdpHomeOdd").value)||2.0;
  const hdpAO=parseFloat(document.getElementById("hdpAwayOdd").value)||2.0;

  function EV(prob,odd){return prob*odd-1;}
  const evOver=EV(ou.over+0.5*ou.halfOver,overOdd);
  const evUnder=EV(ou.under+0.5*ou.halfUnder,underOdd);
  const evHdpHome=EV(hdp.fullWin+0.5*hdp.halfWin+0.5*hdp.push,hdpHO);
  const evHdpAway=EV(hdp.fullLoss+0.5*hdp.halfLoss+0.5*hdp.push,hdpAO);

  let out=`Lambda Home ${lambdaH.toFixed(2)}, Away ${lambdaA.toFixed(2)}\n\n`;
  out+=`O/U ${ouLine}\n Over: ${pct(ou.over)} | HalfWin ${pct(ou.halfOver)} | Push ${pct(ou.push)}\n`;
  out+=` Under: ${pct(ou.under)} | HalfWin ${pct(ou.halfUnder)}\n`;
  out+=` EV Over: ${(evOver*100).toFixed(1)}% | EV Under: ${(evUnder*100).toFixed(1)}%\n\n`;
  out+=`HDP Home ${hdpLine}\n FullWin ${pct(hdp.fullWin)} | HalfWin ${pct(hdp.halfWin)} | Push ${pct(hdp.push)}\n`;
  out+=` HalfLoss ${pct(hdp.halfLoss)} | FullLoss ${pct(hdp.fullLoss)}\n`;
  out+=` EV Home: ${(evHdpHome*100).toFixed(1)}% | EV Away: ${(evHdpAway*100).toFixed(1)}%\n`;

  document.getElementById("output").innerText=out;

  let candidates=[
    {label:`Over ${ouLine}`,ev:evOver},
    {label:`Under ${ouLine}`,ev:evUnder},
    {label:`HDP Home ${hdpLine}`,ev:evHdpHome},
    {label:`HDP Away ${hdpLine}`,ev:evHdpAway}
  ];
  candidates.sort((a,b)=>b.ev-a.ev);
  let best=candidates[0];
  let reco="";
  if(best.ev>0){
    reco=`‚úÖ Rekomendasi Utama: ${best.label} (EV ${(best.ev*100).toFixed(1)}%)\n\nAlternatif:\n`;
    for(let i=1;i<candidates.length;i++){
      reco+=`- ${candidates[i].label} (EV ${(candidates[i].ev*100).toFixed(1)}%)\n`;
    }
  } else { reco="‚ö™ Tidak ada value bet signifikan"; }
  document.getElementById("recommendation").innerText=reco;

  drawDist(M.totalDist);
}

function drawDist(dist){
  const canvas=document.getElementById("distChart");
  const ctx=canvas.getContext("2d");
  const w=canvas.width=canvas.clientWidth, h=canvas.height=canvas.clientHeight;
  ctx.clearRect(0,0,w,h);
  const max=Math.max(...dist), barW=w/dist.length;
  for(let i=0;i<dist.length;i++){
    const p=dist[i]||0, barH=(p/max)*(h-20);
    ctx.fillStyle="#7fb3ff"; ctx.fillRect(i*barW,h-barH,barW-2,barH);
    ctx.fillStyle="#033"; ctx.font="10px Arial"; ctx.fillText(i,i*barW+barW/2,h-5);
  }
}
</script>
</body>
</html>
